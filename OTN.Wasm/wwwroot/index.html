<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OTN.Wasm CAD-like application</title>
    <base href="/" />
    <link href="css/app.css" rel="stylesheet" />
    <link href="OTN.Wasm.styles.css" rel="stylesheet" />
</head>

<body>
    <div id="app">
        <h2>Loading...</h2>
        <div class="progress mt-2" style="height: 2em;">
            <div id="progressbar" class="progress-bar progress-bar-striped progress-bar-animated" style="width: 0%; background-color: #204066;"></div>
        </div>
        <div><span id="progressLabel" class="text-muted">Loading resources...</span></div>
    </div>
    
    <script src="_framework/blazor.webassembly.js" autostart="false"></script>
</body>

<script>
    function startWasmManually() {
        let loadedCount = 0;
        let totalResources = 0;
    
        Blazor.start({
            loadBootResource: function(type, filename, defaultUri, integrity) {
                if (type === "dotnetjs")
                    return defaultUri;
    
                totalResources++;
    
                const fetchTask = fetch(defaultUri, {
                    cache: 'no-cache',
                    integrity: integrity
                });
    
                fetchTask.then(() => {
                    loadedCount++;
                    const percent = Math.floor((loadedCount / totalResources) * 100);
                    const progressbar = document.getElementById('progressbar');
                    progressbar.style.width = percent + '%';
    
                    const progressLabel = document.getElementById('progressLabel');
                    progressLabel.innerText = `Loading ${loadedCount} of ${totalResources}: ${filename}`;
                });
    
                return fetchTask;
            }
        });
    }
    
    startWasmManually();
</script>

</html>